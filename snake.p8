pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
--game loop

function _init()
 game_over=false
 ticks=0
 map_setup()
 make_snake()
 make_food()
end

function _update()
 ticks+=1
 change_direction()
 if ticks>=10 then 
  move_snake()
  ticks=0
 end
 spawn_food()
 if (btnp(❎)) extcmd("reset")
end

function _draw()
 cls()
 if not game_over then
  draw_map()
  draw_score()
  draw_snake()
  draw_food()
 else
  print("game over",246,264,7)
  print(
   "press ❎ to restart",
   228,270,7
  )
  print(
   "final score: "..#s.body-1,
   236,276,7
  ) -- center: 64-len(string)*2
 end
end
-->8
--map code

function map_setup()
 wall=0
 food=1
end

function draw_map()
 map(0,0,0,0,16,16)
end

function draw_score()
 print(
  "score: "..#s.body-1,
  2,15*8+2,0
 )
end

function is_tile(tile_type,x,y)
 tile=mget(x,y)
 has_flag=fget(tile,tile_type)
 return has_flag
end

function can_move(x,y)
 for part in all(s.body) do
  if (x==part.x and y==part.y)
   then return false
  end
 end
 return not is_tile(wall,x,y)
end

function swap_tile(x,y)
 tile=mget(x,y)
 mset(x,y,tile+1)
end
-->8
--snake code

function make_snake()
 s={}
 s.body={}
 s.x=1
 s.y=1
 s.dir='r'
 s.next_dir='r'
 add(s.body,{x=s.x,y=s.y})
end

function draw_snake()
 for index,part in 
  ipairs(s.body) do
   if index==1 then
    spr(1,part.x*8,part.y*8)
   else
    spr(2,part.x*8,part.y*8)
   end
 end
end

function change_direction()
 if (btnp(⬅️) and s.dir~='r')
  then s.next_dir='l'
 elseif (btnp(➡️) and
  s.dir~='l') then
   s.next_dir='r'
 elseif (btnp(⬆️) and
  s.dir~='d') then
   s.next_dir='u'
 elseif (btnp(⬇️) and
  s.dir~='u') then
   s.next_dir='d'
 end
end

function move_snake()
 newx=s.x
 newy=s.y
 
 if (s.next_dir=='l') newx-=1
 if (s.next_dir=='r') newx+=1
 if (s.next_dir=='u') newy-=1
 if (s.next_dir=='d') newy+=1
 
 if (can_move(newx,newy)) then
  s.x=mid(0,newx,16)
  s.y=mid(0,newy,16)
 else
  if not game_over then
   game_over=true
   sfx(1)
   camera(200,200)
  end
 end
 
 add(s.body,{x=s.x,y=s.y},1)
 
 if not (eat_food(newx,newy))
  then del(
   s.body, s.body[#s.body]
  )
 end
 
 s.dir = s.next_dir
end

function eat_food(x,y)
 if (s.x==f.x and s.y==f.y) then
  f.eaten=1
  sfx(0)
  return true
 end
 return false
end
-->8
--food code

function make_food()
 f={}
 f.x=0
 f.y=0
 f.sprite=16
 f.eaten=1
end

function draw_food()
 spr(f.sprite,f.x*8,f.y*8)
end

function spawn_food()
 if f.eaten==1 then
  newx=flr(rnd(14))+1
  newy=flr(rnd(14))+1
  
  while not can_move(newx,newy)
   do
    newx=flr(rnd(14))+1
    newy=flr(rnd(14))+1
  end
  f.x=newx
  f.y=newy
  f.sprite=flr(rnd(4))+16
  f.eaten=0
 end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000330000003b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000033330000bbb30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000333300003bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000033000000b300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00088000000aa000000cc00000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0008e000000a9000000c10000002e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6dddddddddddddddddddddd600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6dddddddddddddddddddddd600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6dddddddddddddddddddddd600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6dddddddddddddddddddddd600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6dddddddddddddddddddddd600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6dddddddddddddddddddddd600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000
6dddddd66dddddd66dddddd66dddddd6444444444444443444444444000000000000000000000000000000000000000000000000000000000000000000000000
6d55ddd66dddddd66ddd55d66dddddd6445444444444434444444444000000000000000000000000000000000000000000000000000000000000000000000000
6d5dddd66dddddd66dddd5d66d5d5dd6454444444444434444444444000000000000000000000000000000000000000000000000000000000000000000000000
6dddddd66dddd5d66d5dddd66dd5d5d6444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000
6dddddd66ddd55d66d55ddd66dddddd6444445444344444444444444000000000000000000000000000000000000000000000000000000000000000000000000
6dddddd66dddddd66dddddd66dddddd6444445544434444444444444000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3031323330313233303132333031323300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3336363636343636363636363636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3235363636363636363536343636363100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3136363436363536363636363636343200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3036363630313636363633303636363300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3336363633323636343632313636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3236363536363636363636363536363100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3136363636363436363634363636363200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3036363636363636363636363636363300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3336343636363636363536363634363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3236363631323636343632333536363100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3136363530333636363631303636363200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3036363536363636353636363436363300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3336363636363634343636363636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3236343636363636363636363436363100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021212122303332313033323130333200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100001305016050180501b0501a050210502505021700237002670028700287000900008000070000500003000030000300003000040000600001000010000100001000010000100005800058000000000000
001000002035022350213501a35013350053500335005300033000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
